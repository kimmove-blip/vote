<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f0f1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="VoteChain">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="manifest" href="manifest-voter.json">
    <title>VoteChain - íˆ¬í‘œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        [v-cloak] { display: none; }
        * { -webkit-tap-highlight-color: transparent; }
        body {
            background: #0f0f1a;
            overscroll-behavior: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .safe-top { padding-top: env(safe-area-inset-top, 0px); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom, 0px); }
        .pb-safe { padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 100px); }
        /* PWA ìŠ¤íƒ ë“œì–¼ë¡  ëª¨ë“œì—ì„œ í—¤ë” ë†’ì´ + safe-area ê³ ë ¤ */
        .pt-header { padding-top: calc(env(safe-area-inset-top, 0px) + 3.5rem + 1rem); }

        /* Animated gradient background */
        .bg-animated {
            background: linear-gradient(-45deg, #0f0f1a, #1a1a2e, #16213e, #0f0f1a);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glass effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Glow effects */
        .glow-blue { box-shadow: 0 0 30px rgba(59, 130, 246, 0.3); }
        .glow-green { box-shadow: 0 0 30px rgba(16, 185, 129, 0.3); }
        .glow-purple { box-shadow: 0 0 30px rgba(139, 92, 246, 0.3); }
        .glow-pink { box-shadow: 0 0 30px rgba(236, 72, 153, 0.3); }

        /* Card effects */
        .vote-card {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .vote-card:active {
            transform: scale(0.98);
        }
        .vote-card.selected {
            border-color: rgba(139, 92, 246, 0.5);
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(59, 130, 246, 0.1) 100%);
        }

        /* Shine effect */
        .shine {
            position: relative;
            overflow: hidden;
        }
        .shine::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0) 40%,
                rgba(255, 255, 255, 0.08) 50%,
                rgba(255, 255, 255, 0) 60%,
                rgba(255, 255, 255, 0) 100%
            );
            transform: rotate(45deg);
            animation: shine 4s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        /* Button gradient */
        .btn-vote {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 50%, #3b82f6 100%);
            background-size: 200% 200%;
            animation: gradientMove 3s ease infinite;
            transition: all 0.3s ease;
        }
        .btn-vote:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.4);
        }
        .btn-vote:active {
            transform: scale(0.98);
        }
        .btn-vote:disabled {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: none;
        }
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Particle canvas */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* Progress animation */
        .progress-bar {
            animation: progressGrow 0.5s ease-out forwards;
        }
        @keyframes progressGrow {
            from { width: 0%; }
        }

        /* Pulse animation */
        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Float animation */
        .float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Modal animation */
        .modal-enter {
            animation: modalIn 0.3s ease-out;
        }
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
    </style>
</head>
<body class="font-sans text-white">
    <canvas id="particles"></canvas>

    <div id="app" v-cloak class="relative z-10 min-h-screen bg-animated">

        <!-- Header -->
        <header class="fixed top-0 left-0 right-0 z-50 safe-top">
            <div class="glass border-b border-white/10">
                <div class="flex items-center px-4 h-14">
                    <!-- ì™¼ìª½: ë’¤ë¡œê°€ê¸° ë˜ëŠ” ë¡œê³  -->
                    <div class="w-12 flex-shrink-0">
                        <button v-if="currentView !== 'home'" @click="goBack" class="p-2 -ml-2 rounded-full active:bg-white/10">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <div v-else class="w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                            </svg>
                        </div>
                    </div>
                    <!-- ê°€ìš´ë°: ì œëª© -->
                    <div class="flex-1 text-center">
                        <h1 v-if="currentView !== 'home'" class="font-semibold truncate">{{ headerTitle }}</h1>
                        <span v-else class="font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">VoteChain</span>
                    </div>
                    <!-- ì˜¤ë¥¸ìª½: ì‹¤ì‹œê°„ ìƒíƒœ -->
                    <div class="w-12 flex-shrink-0 flex items-center justify-end gap-1.5">
                        <span class="w-2 h-2 rounded-full pulse" :class="isConnected ? 'bg-green-400' : 'bg-yellow-400'"></span>
                        <span class="text-xs" :class="isConnected ? 'text-green-400' : 'text-yellow-400'">LIVE</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="pt-header pb-safe min-h-screen">

            <!-- Home View -->
            <div v-if="currentView === 'home'" class="px-4 space-y-6">
                <!-- User Card -->
                <div class="glass rounded-3xl p-6 shine glow-purple">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-blue-600 rounded-2xl flex items-center justify-center">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <p class="text-gray-400 text-sm">ì•ˆë…•í•˜ì„¸ìš”</p>
                            <p class="text-2xl font-bold">{{ userName }}ë‹˜</p>
                        </div>
                        <!-- í¬ë¼ìš´ ì”ì•¡ -->
                        <div class="text-right">
                            <div class="flex items-center gap-1 justify-end">
                                <span class="text-2xl">ğŸ‘‘</span>
                                <span class="text-2xl font-black text-yellow-400">{{ userCrowns.toLocaleString() }}</span>
                            </div>
                            <p class="text-xs text-gray-500">ë³´ìœ  í¬ë¼ìš´</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between pt-4 border-t border-white/10">
                        <div>
                            <p class="text-gray-500 text-xs">DID ì¸ì¦</p>
                            <p class="text-sm font-mono text-purple-400">did:votechain:{{ userId.slice(0, 8) }}...</p>
                        </div>
                        <div class="flex items-center gap-2 px-3 py-1.5 bg-green-500/20 rounded-full">
                            <span class="w-2 h-2 bg-green-400 rounded-full pulse"></span>
                            <span class="text-xs font-medium text-green-400">ì¸ì¦ë¨</span>
                        </div>
                    </div>
                </div>

                <!-- Section Title -->
                <div class="flex items-center justify-between">
                    <h2 class="text-xl font-bold">ì§„í–‰ ì¤‘ì¸ íˆ¬í‘œ</h2>
                    <span class="px-3 py-1 glass rounded-full text-sm text-purple-400">{{ activeElections.length }}ê°œ</span>
                </div>

                <!-- Election Cards -->
                <div v-if="activeElections.length > 0" class="space-y-4">
                    <div v-for="election in activeElections" :key="election.id"
                         @click="selectElection(election)"
                         class="vote-card glass rounded-2xl p-5 shine cursor-pointer"
                         :class="election.is_star_vote ? 'glow-pink' : ''">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span v-if="election.is_star_vote" class="text-xl">â­</span>
                                    <h3 class="font-bold text-lg">{{ election.title }}</h3>
                                </div>
                                <p class="text-gray-400 text-sm">{{ election.description }}</p>
                            </div>
                            <span v-if="election.is_star_vote"
                                  class="px-3 py-1 bg-gradient-to-r from-pink-500 to-purple-500 text-white text-xs font-bold rounded-full">
                                HOT
                            </span>
                            <span v-else class="flex items-center gap-1 px-3 py-1 bg-green-500/20 text-green-400 text-xs font-bold rounded-full">
                                <span class="w-1.5 h-1.5 bg-green-400 rounded-full pulse"></span>
                                ì§„í–‰ì¤‘
                            </span>
                        </div>
                        <div class="flex items-center gap-4 text-sm text-gray-400 mb-4">
                            <span class="flex items-center gap-1.5">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                í›„ë³´ {{ election.candidates.length }}ëª…
                            </span>
                            <span class="flex items-center gap-1.5">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                {{ getRemainingTime(election.end_time) }}
                            </span>
                        </div>
                        <div class="flex items-center justify-between pt-4 border-t border-white/10">
                            <span class="text-xs text-gray-500">{{ getVotingModeLabel(election.voting_mode) }}</span>
                            <span class="text-purple-400 text-sm font-medium flex items-center gap-1">
                                íˆ¬í‘œí•˜ê¸°
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div v-else class="glass rounded-2xl p-10 text-center">
                    <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-10 h-10 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                    </div>
                    <p class="text-gray-500">í˜„ì¬ ì§„í–‰ ì¤‘ì¸ íˆ¬í‘œê°€ ì—†ìŠµë‹ˆë‹¤</p>
                </div>

                <!-- Completed Elections -->
                <div v-if="completedElections.length > 0" class="pt-4">
                    <h2 class="text-lg font-bold mb-4 text-gray-400">ì™„ë£Œëœ íˆ¬í‘œ</h2>
                    <div class="space-y-3">
                        <div v-for="election in completedElections" :key="election.id"
                             @click="viewCompletedElection(election)"
                             class="vote-card glass rounded-xl p-4 cursor-pointer"
                             :class="election.is_star_vote ? 'glow-pink' : ''">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <span v-if="election.is_star_vote" class="text-lg">â­</span>
                                    <div>
                                        <h3 class="font-medium">{{ election.title }}</h3>
                                        <p class="text-xs text-green-400">íˆ¬í‘œ ì™„ë£Œ âœ“</p>
                                    </div>
                                </div>
                                <span class="text-purple-400 text-sm font-medium flex items-center gap-1">
                                    ê²°ê³¼ë³´ê¸°
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vote View -->
            <div v-if="currentView === 'vote'" class="px-4 space-y-4">
                <!-- Election Info -->
                <div class="glass rounded-2xl p-5 shine">
                    <h2 class="font-bold text-xl mb-2">{{ selectedElection?.title }}</h2>
                    <p class="text-gray-400 text-sm mb-3">{{ selectedElection?.description }}</p>
                    <div class="flex items-center gap-3">
                        <span v-if="selectedElection?.status === 'completed'"
                              class="px-3 py-1 bg-green-500/20 text-green-400 text-xs font-medium rounded-full">
                            íˆ¬í‘œ ì™„ë£Œ âœ“
                        </span>
                        <span v-else class="px-3 py-1 bg-purple-500/20 text-purple-400 text-xs font-medium rounded-full">
                            {{ getVotingModeLabel(selectedElection?.voting_mode) }}
                        </span>
                        <span v-if="selectedElection?.status !== 'completed'" class="text-xs text-gray-500">{{ getRemainingTime(selectedElection?.end_time) }} ë‚¨ìŒ</span>
                    </div>
                </div>

                <!-- Instructions -->
                <p class="text-gray-400 text-sm px-1">
                    <span v-if="selectedElection?.voting_mode === 'single'">í›„ë³´ 1ëª…ì„ ì„ íƒí•˜ì„¸ìš”</span>
                    <span v-else-if="selectedElection?.voting_mode === 'multi_limited'">ìµœëŒ€ {{ selectedElection?.max_candidates }}ëª…ê¹Œì§€ ì„ íƒ ê°€ëŠ¥</span>
                    <span v-else>íˆ¬í‘œí•  í›„ë³´ë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
                </p>

                <!-- Candidate List - Normal -->
                <div v-if="!selectedElection?.is_star_vote" class="space-y-3">
                    <div v-for="candidate in selectedElection?.candidates" :key="candidate.id"
                         @click="toggleCandidate(candidate)"
                         class="vote-card glass rounded-2xl p-4 cursor-pointer"
                         :class="{ 'selected glow-purple': isSelected(candidate) }">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-2xl font-black transition-all"
                                 :class="isSelected(candidate) ? 'bg-gradient-to-br from-purple-500 to-blue-600' : 'bg-white/10'">
                                {{ candidate.symbol_number }}
                            </div>
                            <div class="flex-1">
                                <p class="font-bold text-lg">{{ candidate.name }}</p>
                                <p class="text-sm text-gray-400">{{ candidate.party || 'ë¬´ì†Œì†' }}</p>
                            </div>
                            <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all"
                                 :class="isSelected(candidate) ? 'border-purple-500 bg-purple-500' : 'border-gray-600'">
                                <svg v-if="isSelected(candidate)" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Candidate List - Star Vote (with photos) -->
                <div v-if="selectedElection?.is_star_vote" class="grid grid-cols-2 gap-3">
                    <div v-for="candidate in selectedElection?.candidates" :key="candidate.id"
                         class="vote-card glass rounded-2xl overflow-hidden cursor-pointer relative"
                         :class="{ 'selected glow-pink': isSelected(candidate) }">
                        <!-- Photo -->
                        <div class="relative" @click="openStarModal(candidate)">
                            <img :src="candidate.image" class="w-full aspect-[3/4] object-cover">
                            <!-- Video icon -->
                            <div v-if="candidate.video" class="absolute top-2 right-2 w-8 h-8 bg-black/50 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M8 5v14l11-7z"/>
                                </svg>
                            </div>
                            <!-- Rank badge -->
                            <div class="absolute top-2 left-2 w-8 h-8 bg-gradient-to-br from-pink-500 to-purple-600 rounded-full flex items-center justify-center text-sm font-black">
                                {{ candidate.symbol_number }}
                            </div>
                            <!-- Gradient overlay -->
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent p-3">
                                <p class="font-bold text-lg">{{ candidate.name }}</p>
                                <p class="text-xs text-gray-300">{{ candidate.party }}</p>
                            </div>
                        </div>
                        <!-- íˆ¬í‘œìˆ˜ & í¬ë¼ìš´ -->
                        <div class="px-3 pt-2">
                            <div class="flex items-center justify-between text-xs mb-1.5">
                                <div class="flex items-center gap-1">
                                    <span>ğŸ—³ï¸</span>
                                    <span class="font-bold text-purple-400">{{ (candidate.votes || 0).toLocaleString() }}í‘œ</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span>ğŸ‘‘</span>
                                    <span class="font-bold text-yellow-400">{{ (candidate.crowns || 0).toLocaleString() }}</span>
                                </div>
                            </div>
                            <!-- ë“í‘œìœ¨ ë°” -->
                            <div class="h-1.5 bg-white/10 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all duration-500"
                                     :style="{width: getVotePercent(candidate) + '%'}"></div>
                            </div>
                        </div>
                        <!-- Vote button -->
                        <div class="p-3 pt-2">
                            <button @click.stop="toggleCandidate(candidate)"
                                    class="w-full py-2.5 rounded-xl font-semibold text-sm transition-all"
                                    :class="isSelected(candidate) ? 'bg-gradient-to-r from-pink-500 to-purple-600' : 'bg-white/10 hover:bg-white/20'">
                                {{ isSelected(candidate) ? 'ì„ íƒë¨ âœ“' : 'íˆ¬í‘œí•˜ê¸°' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Star Candidate Detail Modal -->
            <div v-if="showStarModal"
                 class="fixed inset-0 z-50 bg-black/95 overflow-y-auto"
                 style="padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom);">
                <div class="modal-enter min-h-full">
                    <!-- Media -->
                    <div class="relative">
                        <div v-if="currentMediaType === 'video'" class="aspect-square bg-black overflow-hidden relative">
                            <video ref="starVideo" :src="currentMedia"
                                   playsinline autoplay muted loop
                                   :poster="starModalCandidate?.image"
                                   @click="toggleMute"
                                   class="w-full h-full object-cover"></video>
                            <!-- ìŒì†Œê±° ìƒíƒœ í‘œì‹œ ë²„íŠ¼ -->
                            <button @click="toggleMute"
                                    class="absolute bottom-4 right-4 px-4 py-2 bg-black/60 backdrop-blur rounded-full flex items-center gap-2 transition-all active:scale-95">
                                <span v-if="isMuted" class="text-lg">ğŸ”‡</span>
                                <span v-else class="text-lg">ğŸ”Š</span>
                                <span class="text-sm font-medium">{{ isMuted ? 'íƒ­í•˜ì—¬ ì†Œë¦¬ ì¼œê¸°' : 'ì†Œë¦¬ ì¼œì§' }}</span>
                            </button>
                        </div>
                        <img v-else :src="currentMedia" class="w-full aspect-square object-cover">
                        <!-- Close -->
                        <button @click="closeStarModal"
                                class="absolute top-4 right-4 w-12 h-12 bg-black/60 backdrop-blur rounded-full flex items-center justify-center z-10">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                        <!-- Info overlay -->
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/50 to-transparent p-5 pointer-events-none">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="px-3 py-1 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full text-sm font-bold">
                                    #{{ starModalCandidate?.symbol_number }}
                                </span>
                            </div>
                            <h3 class="text-3xl font-black">{{ starModalCandidate?.name }}</h3>
                            <p class="text-gray-300">{{ starModalCandidate?.party }}</p>
                        </div>
                    </div>
                    <!-- Content -->
                    <div class="p-5 space-y-5 bg-gradient-to-b from-black to-gray-900">
                        <!-- ì‹¤ì‹œê°„ íˆ¬í‘œ & í¬ë¼ìš´ í˜„í™© -->
                        <div class="glass rounded-2xl p-4">
                            <!-- íˆ¬í‘œìˆ˜ í˜„í™© -->
                            <div class="flex items-center justify-between mb-4 pb-4 border-b border-white/10">
                                <div class="flex items-center gap-3">
                                    <span class="text-3xl">ğŸ—³ï¸</span>
                                    <div>
                                        <p class="text-2xl font-black text-purple-400">{{ (starModalCandidate?.votes || 0).toLocaleString() }}í‘œ</p>
                                        <p class="text-xs text-gray-500">ë“í‘œìˆ˜</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-black text-purple-400">{{ getVotePercent(starModalCandidate) }}%</p>
                                    <p class="text-xs text-gray-500">ë“í‘œìœ¨</p>
                                </div>
                            </div>
                            <!-- í¬ë¼ìš´ í˜„í™© -->
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <span class="text-3xl">ğŸ‘‘</span>
                                    <div>
                                        <p class="text-2xl font-black text-yellow-400">{{ (starModalCandidate?.crowns || 0).toLocaleString() }}</p>
                                        <p class="text-xs text-gray-500">ë°›ì€ í¬ë¼ìš´</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-2xl font-black text-yellow-400">{{ getCrownPercent(starModalCandidate) }}%</p>
                                    <p class="text-xs text-gray-500">í¬ë¼ìš´ ì ìœ ìœ¨</p>
                                </div>
                            </div>
                            <!-- í¬ë¼ìš´ ì˜ê¸° ë²„íŠ¼ë“¤ -->
                            <div class="flex gap-2">
                                <button @click="sendCrown(starModalCandidate, 1)"
                                        class="flex-1 py-3 rounded-xl font-bold text-sm transition-all active:scale-95"
                                        :class="userCrowns >= 1 ? 'bg-gradient-to-r from-yellow-500 to-amber-600' : 'bg-gray-600 opacity-50'">
                                    ğŸ‘‘ 1ê°œ
                                </button>
                                <button @click="sendCrown(starModalCandidate, 10)"
                                        class="flex-1 py-3 rounded-xl font-bold text-sm transition-all active:scale-95"
                                        :class="userCrowns >= 10 ? 'bg-gradient-to-r from-yellow-400 to-orange-500' : 'bg-gray-600 opacity-50'">
                                    ğŸ‘‘ 10ê°œ
                                </button>
                                <button @click="sendCrown(starModalCandidate, 100)"
                                        class="flex-1 py-3 rounded-xl font-bold text-sm transition-all active:scale-95"
                                        :class="userCrowns >= 100 ? 'bg-gradient-to-r from-amber-400 to-red-500' : 'bg-gray-600 opacity-50'">
                                    ğŸ‘‘ 100ê°œ
                                </button>
                            </div>
                            <p class="text-center text-xs text-gray-500 mt-2">ë‚´ í¬ë¼ìš´: {{ userCrowns.toLocaleString() }}ê°œ</p>
                        </div>
                        <!-- Profile -->
                        <div>
                            <h4 class="text-sm font-bold text-gray-400 mb-2">í”„ë¡œí•„</h4>
                            <p class="text-gray-300 leading-relaxed">{{ starModalCandidate?.bio }}</p>
                        </div>
                        <!-- Gallery -->
                        <div v-if="starModalCandidate?.gallery?.length || starModalCandidate?.video">
                            <h4 class="text-sm font-bold text-gray-400 mb-3">ê°¤ëŸ¬ë¦¬</h4>
                            <div class="flex gap-2 overflow-x-auto pb-2 -mx-5 px-5">
                                <!-- ë©”ì¸ ì´ë¯¸ì§€ ì¸ë„¤ì¼ -->
                                <div @click="setCurrentMedia(starModalCandidate.image, 'image')"
                                     class="relative flex-shrink-0 cursor-pointer rounded-xl overflow-hidden"
                                     :class="currentMedia === starModalCandidate.image ? 'ring-2 ring-pink-500' : ''">
                                    <img :src="starModalCandidate.image" class="w-20 h-20 object-cover">
                                </div>
                                <!-- ë™ì˜ìƒ ì¸ë„¤ì¼ -->
                                <div v-if="starModalCandidate?.video"
                                     @click="setCurrentMedia(starModalCandidate.video, 'video')"
                                     class="relative flex-shrink-0 cursor-pointer rounded-xl overflow-hidden"
                                     :class="currentMedia === starModalCandidate.video ? 'ring-2 ring-pink-500' : ''">
                                    <img :src="starModalCandidate.image" class="w-20 h-20 object-cover">
                                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
                                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M8 5v14l11-7z"/>
                                        </svg>
                                    </div>
                                </div>
                                <!-- ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ë“¤ -->
                                <div v-for="(img, i) in starModalCandidate.gallery" :key="i"
                                     @click="setCurrentMedia(img, 'image')"
                                     class="flex-shrink-0 cursor-pointer rounded-xl overflow-hidden"
                                     :class="currentMedia === img ? 'ring-2 ring-pink-500' : ''">
                                    <img :src="img" class="w-20 h-20 object-cover">
                                </div>
                            </div>
                        </div>
                        <!-- ì‘ì› ëŒ“ê¸€ -->
                        <div>
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-sm font-bold text-gray-400">ì‘ì› ëŒ“ê¸€</h4>
                                <span class="text-xs text-pink-400">{{ getCommentsForCandidate(starModalCandidate?.id).length }}ê°œ</span>
                            </div>
                            <!-- ëŒ“ê¸€ ì…ë ¥ -->
                            <div class="flex gap-2 mb-4">
                                <input type="text" v-model="newComment"
                                       @keyup.enter="addComment(starModalCandidate)"
                                       placeholder="ì‘ì› ë©”ì‹œì§€ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”..."
                                       class="flex-1 bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-sm placeholder-gray-500 focus:outline-none focus:border-pink-500">
                                <button @click="addComment(starModalCandidate)"
                                        class="px-4 py-3 rounded-xl font-semibold text-sm transition-all"
                                        :class="newComment.trim() ? 'bg-gradient-to-r from-pink-500 to-purple-600' : 'bg-gray-600 opacity-50'">
                                    ğŸ‘‘10 ë“±ë¡
                                </button>
                            </div>
                            <!-- ëŒ“ê¸€ ëª©ë¡ -->
                            <div class="space-y-3 max-h-60 overflow-y-auto">
                                <div v-for="comment in getCommentsForCandidate(starModalCandidate?.id)" :key="comment.id"
                                     class="bg-white/5 rounded-xl p-3">
                                    <div class="flex items-center gap-2 mb-1">
                                        <div class="w-6 h-6 bg-gradient-to-br from-pink-500 to-purple-600 rounded-full flex items-center justify-center text-xs font-bold">
                                            {{ comment.user.charAt(0) }}
                                        </div>
                                        <span class="text-sm font-medium">{{ comment.user }}</span>
                                        <span class="text-xs text-gray-500">{{ comment.time }}</span>
                                    </div>
                                    <p class="text-sm text-gray-300 pl-8">{{ comment.text }}</p>
                                </div>
                                <div v-if="getCommentsForCandidate(starModalCandidate?.id).length === 0"
                                     class="text-center py-6 text-gray-500 text-sm">
                                    ì²« ë²ˆì§¸ ì‘ì› ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!
                                </div>
                            </div>
                        </div>
                        <!-- Vote button -->
                        <button @click="selectStarAndClose(starModalCandidate)"
                                class="w-full py-4 rounded-2xl font-bold text-lg transition-all"
                                :class="isSelected(starModalCandidate) ? 'bg-gradient-to-r from-green-500 to-emerald-600' : 'bg-gradient-to-r from-pink-500 to-purple-600'">
                            {{ isSelected(starModalCandidate) ? 'ì„ íƒ ì™„ë£Œ âœ“' : 'ì´ ìŠ¤íƒ€ì—ê²Œ íˆ¬í‘œí•˜ê¸°' }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Confirm View -->
            <div v-if="currentView === 'confirm'" class="px-4">
                <div class="glass rounded-3xl p-6 shine text-center">
                    <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-5 float">
                        <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-black mb-2">íˆ¬í‘œ í™•ì¸</h2>
                    <p class="text-gray-400 mb-6">ì„ íƒí•˜ì‹  í›„ë³´ê°€ ë§ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”</p>

                    <div class="bg-white/5 rounded-2xl p-5 mb-6 text-left">
                        <p class="text-sm text-gray-500 mb-4">{{ selectedElection?.title }}</p>
                        <div v-for="candidate in selectedCandidates" :key="candidate.id"
                             class="flex items-center gap-4 py-3 border-b border-white/5 last:border-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-600 rounded-xl flex items-center justify-center text-xl font-black">
                                {{ candidate.symbol_number }}
                            </div>
                            <div>
                                <p class="font-bold">{{ candidate.name }}</p>
                                <p class="text-xs text-gray-500">{{ candidate.party || 'ë¬´ì†Œì†' }}</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-amber-500/10 border border-amber-500/30 rounded-2xl p-4 text-left">
                        <div class="flex gap-3">
                            <svg class="w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                            <div>
                                <p class="font-medium text-amber-400 text-sm">íˆ¬í‘œ í›„ ë³€ê²½ ë¶ˆê°€</p>
                                <p class="text-xs text-amber-400/70 mt-0.5">íˆ¬í‘œëŠ” ë¸”ë¡ì²´ì¸ì— ì˜êµ¬ ê¸°ë¡ë©ë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Success View -->
            <div v-if="currentView === 'success'" class="px-4 flex flex-col items-center justify-center min-h-[70vh]">
                <div class="text-center">
                    <div class="w-28 h-28 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6 float">
                        <svg class="w-14 h-14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </div>
                    <h2 class="text-3xl font-black mb-2">íˆ¬í‘œ ì™„ë£Œ!</h2>
                    <p class="text-gray-400 mb-8">ì†Œì¤‘í•œ í•œ í‘œ ê°ì‚¬í•©ë‹ˆë‹¤</p>

                    <div class="glass rounded-2xl p-5 text-left mb-6 shine">
                        <p class="text-xs text-gray-500 mb-4">íˆ¬í‘œ ì˜ìˆ˜ì¦</p>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-500">ì„ ê±°</span>
                                <span class="font-medium">{{ selectedElection?.title }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-500">íŠ¸ëœì­ì…˜</span>
                                <span class="font-mono text-sm text-purple-400">{{ receiptCode }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-500">ë¸”ë¡</span>
                                <span class="font-bold text-blue-400">#{{ blockNumber }}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-500">ì‹œê°„</span>
                                <span class="font-medium">{{ voteTime }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center justify-center gap-2 text-sm text-green-400">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                        ë¸”ë¡ì²´ì¸ì— ì•ˆì „í•˜ê²Œ ê¸°ë¡ë¨
                    </div>
                </div>
            </div>

        </main>

        <!-- Bottom Action Bar -->
        <div v-if="(currentView === 'vote' && selectedElection?.status !== 'completed') || currentView === 'confirm'"
             class="fixed bottom-0 left-0 right-0 z-40 glass border-t border-white/10 p-4 safe-bottom">
            <button v-if="currentView === 'vote'"
                    @click="goToConfirm"
                    :disabled="selectedCandidates.length === 0"
                    class="btn-vote w-full py-4 rounded-2xl font-bold text-lg disabled:text-gray-500">
                {{ selectedCandidates.length > 0 ? `${selectedCandidates.length}ëª… ì„ íƒ ì™„ë£Œ` : 'í›„ë³´ë¥¼ ì„ íƒí•˜ì„¸ìš”' }}
            </button>
            <div v-if="currentView === 'confirm'" class="flex gap-3">
                <button @click="currentView = 'vote'"
                        class="flex-1 py-4 rounded-2xl glass border border-white/20 font-semibold">
                    ë‹¤ì‹œ ì„ íƒ
                </button>
                <button @click="submitVote"
                        :disabled="submitting"
                        class="btn-vote flex-[2] py-4 rounded-2xl font-bold flex items-center justify-center gap-2">
                    <svg v-if="submitting" class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    {{ submitting ? 'íˆ¬í‘œ ì¤‘...' : 'íˆ¬í‘œí•˜ê¸°' }}
                </button>
            </div>
        </div>

        <div v-if="currentView === 'success'"
             class="fixed bottom-0 left-0 right-0 z-40 glass border-t border-white/10 p-4 safe-bottom">
            <button @click="goHome" class="btn-vote w-full py-4 rounded-2xl font-bold text-lg">
                í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>

        <!-- Biometric Modal -->
        <div v-if="showBiometric" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="modal-enter glass rounded-3xl p-8 w-full max-w-sm text-center">
                <div class="w-24 h-24 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-5 float">
                    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4"/>
                    </svg>
                </div>
                <h3 class="text-2xl font-black mb-2">ë³¸ì¸ ì¸ì¦</h3>
                <p class="text-gray-400 mb-6">ìƒì²´ ì¸ì¦ìœ¼ë¡œ ë³¸ì¸ì„ í™•ì¸í•©ë‹ˆë‹¤</p>
                <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-purple-500 to-blue-500 rounded-full progress-bar" style="width: 60%"></div>
                </div>
            </div>
        </div>

        <!-- í¬ë¼ìš´ ì¶©ì „ Modal -->
        <div v-if="showRechargeModal" class="fixed inset-0 z-50 bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="modal-enter glass rounded-3xl p-6 w-full max-w-sm">
                <!-- í—¤ë” -->
                <div class="text-center mb-6">
                    <div class="w-20 h-20 bg-gradient-to-br from-yellow-400 to-amber-600 rounded-full flex items-center justify-center mx-auto mb-4 float">
                        <span class="text-4xl">ğŸ‘‘</span>
                    </div>
                    <h3 class="text-2xl font-black mb-1">í¬ë¼ìš´ ì¶©ì „</h3>
                    <p class="text-gray-400 text-sm">í¬ë¼ìš´ìœ¼ë¡œ ìŠ¤íƒ€ë¥¼ ì‘ì›í•˜ì„¸ìš”!</p>
                    <p class="text-yellow-400 font-bold mt-2">í˜„ì¬ ë³´ìœ : {{ userCrowns.toLocaleString() }}ê°œ</p>
                </div>

                <!-- ì¶©ì „ ì˜µì…˜ -->
                <div class="space-y-3 mb-6">
                    <button @click="purchaseCrowns(100, 1000)"
                            class="w-full flex items-center justify-between p-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition-all active:scale-98">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ‘‘</span>
                            <div class="text-left">
                                <p class="font-bold">100 í¬ë¼ìš´</p>
                                <p class="text-xs text-gray-500">ì…ë¬¸ììš©</p>
                            </div>
                        </div>
                        <span class="font-black text-yellow-400">â‚©1,000</span>
                    </button>

                    <button @click="purchaseCrowns(550, 5000)"
                            class="w-full flex items-center justify-between p-4 rounded-2xl bg-gradient-to-r from-yellow-500/10 to-amber-500/10 border border-yellow-500/30 hover:from-yellow-500/20 hover:to-amber-500/20 transition-all active:scale-98">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ‘‘</span>
                            <div class="text-left">
                                <p class="font-bold">550 í¬ë¼ìš´ <span class="text-xs text-green-400 ml-1">+10%</span></p>
                                <p class="text-xs text-gray-500">ì¸ê¸° ìƒí’ˆ</p>
                            </div>
                        </div>
                        <span class="font-black text-yellow-400">â‚©5,000</span>
                    </button>

                    <button @click="purchaseCrowns(1200, 10000)"
                            class="w-full flex items-center justify-between p-4 rounded-2xl bg-white/5 border border-white/10 hover:bg-white/10 transition-all active:scale-98">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ‘‘</span>
                            <div class="text-left">
                                <p class="font-bold">1,200 í¬ë¼ìš´ <span class="text-xs text-green-400 ml-1">+20%</span></p>
                                <p class="text-xs text-gray-500">ì•Œëœ° íŒ¨í‚¤ì§€</p>
                            </div>
                        </div>
                        <span class="font-black text-yellow-400">â‚©10,000</span>
                    </button>

                    <button @click="purchaseCrowns(3500, 25000)"
                            class="w-full flex items-center justify-between p-4 rounded-2xl bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/30 hover:from-purple-500/20 hover:to-pink-500/20 transition-all active:scale-98">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ’</span>
                            <div class="text-left">
                                <p class="font-bold">3,500 í¬ë¼ìš´ <span class="text-xs text-green-400 ml-1">+40%</span></p>
                                <p class="text-xs text-gray-500">VIP íŒ¨í‚¤ì§€</p>
                            </div>
                        </div>
                        <span class="font-black text-purple-400">â‚©25,000</span>
                    </button>

                    <button @click="purchaseCrowns(8000, 50000)"
                            class="w-full flex items-center justify-between p-4 rounded-2xl bg-gradient-to-r from-amber-500/20 to-yellow-400/20 border border-amber-400/50 hover:from-amber-500/30 hover:to-yellow-400/30 transition-all active:scale-98 relative overflow-hidden">
                        <div class="absolute top-0 right-0 px-2 py-0.5 bg-gradient-to-r from-red-500 to-pink-500 text-xs font-bold rounded-bl-lg">BEST</div>
                        <div class="flex items-center gap-3">
                            <span class="text-2xl">ğŸ†</span>
                            <div class="text-left">
                                <p class="font-bold">8,000 í¬ë¼ìš´ <span class="text-xs text-green-400 ml-1">+60%</span></p>
                                <p class="text-xs text-gray-500">í”„ë¦¬ë¯¸ì—„ íŒ¨í‚¤ì§€</p>
                            </div>
                        </div>
                        <span class="font-black text-amber-400">â‚©50,000</span>
                    </button>
                </div>

                <!-- ë‹«ê¸° ë²„íŠ¼ -->
                <button @click="showRechargeModal = false"
                        class="w-full py-3 rounded-xl bg-white/10 font-semibold text-gray-400 hover:bg-white/20 transition-all">
                    ë‚˜ì¤‘ì— í•˜ê¸°
                </button>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                const currentView = ref('home');
                const userName = ref('í™ê¸¸ë™');
                const userId = ref('a1b2c3d4e5f6g7h8');
                const userCrowns = ref(500);
                const submitting = ref(false);
                const showBiometric = ref(false);
                const showRechargeModal = ref(false);

                const selectedElection = ref(null);
                const selectedCandidates = ref([]);
                const showStarModal = ref(false);
                const starModalCandidate = ref(null);
                const currentMedia = ref('');
                const currentMediaType = ref('image');
                const isMuted = ref(true);
                const newComment = ref('');
                const comments = ref([
                    { id: 1, candidateId: 10, user: 'ë³„ë¹›íŒ¬', text: 'íƒœì—° ì–¸ë‹ˆ ìµœê³ ! í•­ìƒ ì‘ì›í•´ìš” ğŸ’•', time: '5ë¶„ ì „' },
                    { id: 2, candidateId: 10, user: 'ìŠ¤í…”ë¼ëŸ¬ë²„', text: 'ë¬´ëŒ€ ë„ˆë¬´ ë©‹ìˆì–´ìš” âœ¨', time: '12ë¶„ ì „' },
                    { id: 3, candidateId: 10, user: 'ìŒì•…ì²œì‚¬', text: 'ëª©ì†Œë¦¬ê°€ ì •ë§ ì²œìƒì˜ ì†Œë¦¬...', time: '1ì‹œê°„ ì „' },
                    { id: 4, candidateId: 12, user: 'ë¸”ë£¸íŒ¬', text: 'ì„œì—°ì´ í™”ì´íŒ…! 1ë“±í•˜ì! ğŸ†', time: '3ë¶„ ì „' },
                    { id: 5, candidateId: 12, user: 'ë·°í‹°í€¸', text: 'ë¹„ì£¼ì–¼ ì§„ì§œ ë¯¸ì³¤ë‹¤...', time: '30ë¶„ ì „' },
                    { id: 6, candidateId: 11, user: 'ë…¸ë°”ìŠ¤íƒ€', text: 'ì¤€í˜ì´ ì¶¤ ë„ˆë¬´ ì˜ ì¶°ìš”!', time: '15ë¶„ ì „' },
                ]);

                const receiptCode = ref('');
                const blockNumber = ref(0);
                const voteTime = ref('');

                const elections = ref([
                    {
                        id: 1,
                        title: '2026ë…„ ì •ê¸°ì´íšŒ íšŒì¥ ì„ ê±°',
                        description: 'ì œ15ëŒ€ íšŒì¥ ì„ ì¶œì„ ìœ„í•œ ì„ ê±°ì…ë‹ˆë‹¤',
                        voting_mode: 'single',
                        status: 'active',
                        end_time: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                        candidates: [
                            { id: 1, symbol_number: 1, name: 'ê¹€ì² ìˆ˜', party: 'í˜ì‹ ë‹¹' },
                            { id: 2, symbol_number: 2, name: 'ì´ì˜í¬', party: 'ë¯¸ë˜ë‹¹' },
                            { id: 3, symbol_number: 3, name: 'ë°•ë¯¼ìˆ˜', party: 'ë¬´ì†Œì†' },
                        ]
                    },
                    {
                        id: 2,
                        title: 'ì‹ ê·œ ì‚¬ì—… ì œì•ˆ íˆ¬í‘œ',
                        description: '2026ë…„ ì‹ ê·œ ì‚¬ì—… ì§„í–‰ ì—¬ë¶€ ê²°ì •',
                        voting_mode: 'single',
                        status: 'active',
                        end_time: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                        candidates: [
                            { id: 4, symbol_number: 1, name: 'ì°¬ì„±', party: '' },
                            { id: 5, symbol_number: 2, name: 'ë°˜ëŒ€', party: '' },
                        ]
                    },
                    {
                        id: 3,
                        title: 'STAR VOTE 2026 - ì˜¬í•´ì˜ ìŠ¤íƒ€',
                        description: '2026ë…„ ìµœê³ ì˜ ìŠ¤íƒ€ë¥¼ íˆ¬í‘œë¡œ ì„ ì •í•©ë‹ˆë‹¤',
                        voting_mode: 'single',
                        status: 'active',
                        end_time: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                        is_star_vote: true,
                        candidates: [
                            { id: 10, symbol_number: 1, name: 'ê¹€íƒœì—°', party: 'STELLAR', crowns: 15234, votes: 3842,
                              image: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=600&fit=crop',
                              video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
                              bio: '2019ë…„ ë°ë·” ì´í›„ ê¾¸ì¤€í•œ ì‚¬ë‘ì„ ë°›ê³  ìˆëŠ” STELLARì˜ ë©”ì¸ë³´ì»¬. ë›°ì–´ë‚œ ê°€ì°½ë ¥ê³¼ ë¬´ëŒ€ ì¥ì•…ë ¥ìœ¼ë¡œ ë§ì€ íŒ¬ë“¤ì˜ ì‚¬ë‘ì„ ë°›ê³  ìˆìŠµë‹ˆë‹¤.',
                              gallery: [
                                'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=200&h=200&fit=crop',
                                'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&h=200&fit=crop',
                                'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=200&h=200&fit=crop',
                              ] },
                            { id: 11, symbol_number: 2, name: 'ë°•ì¤€í˜', party: 'NOVA', crowns: 12891, votes: 3215,
                              image: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400&h=600&fit=crop',
                              bio: 'NOVAì˜ ë¦¬ë”ì´ì ë©”ì¸ëŒ„ì„œ. ì¹¼êµ°ë¬´ì™€ íŒŒì›Œí’€í•œ í¼í¬ë¨¼ìŠ¤ë¡œ ìœ ëª…í•©ë‹ˆë‹¤.',
                              gallery: [
                                'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=200&h=200&fit=crop',
                                'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop',
                              ] },
                            { id: 12, symbol_number: 3, name: 'ì´ì„œì—°', party: 'BLOOM', crowns: 11567, votes: 2987,
                              image: 'https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=400&h=600&fit=crop',
                              video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4',
                              bio: 'BLOOMì˜ ë¹„ì£¼ì–¼ ë‹´ë‹¹. ëª¨ë¸ ì¶œì‹ ìœ¼ë¡œ ë›°ì–´ë‚œ ë¹„ì£¼ì–¼ê³¼ ì—°ê¸°ë ¥ì„ ê²¸ë¹„í–ˆìŠµë‹ˆë‹¤.',
                              gallery: [
                                'https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?w=200&h=200&fit=crop',
                                'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=200&h=200&fit=crop',
                                'https://images.unsplash.com/photo-1529139574466-a303027c1d8b?w=200&h=200&fit=crop',
                              ] },
                            { id: 13, symbol_number: 4, name: 'ì •ìš°ì§„', party: 'ECLIPSE', crowns: 9874, votes: 2654,
                              image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop',
                              bio: 'ECLIPSEì˜ ë©”ì¸ë˜í¼. ì‘ì‚¬ì‘ê³¡ ì‹¤ë ¥ë„ ë›°ì–´ë‚©ë‹ˆë‹¤.' },
                            { id: 14, symbol_number: 5, name: 'í•œì†Œí¬', party: 'PRISM', crowns: 8765, votes: 2341,
                              image: 'https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=400&h=600&fit=crop',
                              bio: 'PRISMì˜ ë©”ì¸ë³´ì»¬. ê°ì„±ì ì¸ ìŒìƒ‰ìœ¼ë¡œ ì‚¬ë‘ë°›ê³  ìˆìŠµë‹ˆë‹¤.',
                              gallery: [
                                'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop',
                                'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop',
                              ] },
                            { id: 15, symbol_number: 6, name: 'ìµœë¯¼ìˆ˜', party: 'ZENITH', crowns: 7654, votes: 2108,
                              image: 'https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?w=400&h=600&fit=crop',
                              bio: 'ZENITHì˜ ë§‰ë‚´. ê·€ì—¬ìš´ ë§¤ë ¥ê³¼ ë›°ì–´ë‚œ ì˜ˆëŠ¥ê°ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.' },
                            { id: 16, symbol_number: 7, name: 'ê°•ì˜ˆë¦°', party: 'AURORA', crowns: 6543, votes: 1876,
                              image: 'https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?w=400&h=600&fit=crop',
                              bio: 'AURORAì˜ ë¦¬ë”. ì‘ê³¡ê°€ë¡œì„œë„ í™œë°œíˆ í™œë™ ì¤‘ì…ë‹ˆë‹¤.',
                              gallery: [
                                'https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=200&h=200&fit=crop',
                              ] },
                            { id: 17, symbol_number: 8, name: 'ìœ¤ì¬í˜„', party: 'ORBIT', crowns: 5432, votes: 1654,
                              image: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400&h=600&fit=crop',
                              bio: 'ORBITì˜ ë©”ì¸ëŒ„ì„œ. ë…ë³´ì ì¸ ì¶¤ ì‹¤ë ¥ì„ ìë‘í•©ë‹ˆë‹¤.' },
                        ]
                    }
                ]);

                const completedElections = ref([
                    { id: 100, title: '2025ë…„ ì˜ˆì‚°ì•ˆ ìŠ¹ì¸', status: 'completed' }
                ]);

                const activeElections = computed(() => {
                    const active = elections.value.filter(e => e.status === 'active');
                    // ìŠ¤íƒ€íˆ¬í‘œë¥¼ ì œì¼ ìœ„ë¡œ
                    return active.sort((a, b) => (b.is_star_vote ? 1 : 0) - (a.is_star_vote ? 1 : 0));
                });

                const headerTitle = computed(() => {
                    switch(currentView.value) {
                        case 'home': return '';
                        case 'vote': return 'íˆ¬í‘œ';
                        case 'confirm': return 'í™•ì¸';
                        case 'success': return 'ì™„ë£Œ';
                        default: return '';
                    }
                });

                const selectElection = (election) => {
                    selectedElection.value = election;
                    selectedCandidates.value = [];
                    currentView.value = 'vote';
                    // ìŠ¤í¬ë¡¤ì„ ìƒë‹¨ìœ¼ë¡œ ë¦¬ì…‹
                    window.scrollTo(0, 0);
                };

                const viewCompletedElection = (election) => {
                    selectedElection.value = election;
                    selectedCandidates.value = [];
                    currentView.value = 'vote';
                    window.scrollTo(0, 0);
                };

                const toggleCandidate = (candidate) => {
                    const mode = selectedElection.value?.voting_mode;
                    const idx = selectedCandidates.value.findIndex(c => c.id === candidate.id);

                    if (idx > -1) {
                        selectedCandidates.value.splice(idx, 1);
                    } else {
                        if (mode === 'single') {
                            selectedCandidates.value = [candidate];
                        } else {
                            const max = selectedElection.value?.max_candidates || 3;
                            if (selectedCandidates.value.length < max) {
                                selectedCandidates.value.push(candidate);
                            }
                        }
                    }
                };

                const isSelected = (candidate) => {
                    return selectedCandidates.value.some(c => c.id === candidate.id);
                };

                const openStarModal = (candidate) => {
                    starModalCandidate.value = candidate;
                    // ë™ì˜ìƒì´ ìˆìœ¼ë©´ ê¸°ë³¸ìœ¼ë¡œ ë™ì˜ìƒ ì¬ìƒ
                    if (candidate.video) {
                        currentMedia.value = candidate.video;
                        currentMediaType.value = 'video';
                        isMuted.value = true; // ì²˜ìŒì—” ìŒì†Œê±°ë¡œ ì‹œì‘
                    } else {
                        currentMedia.value = candidate.image;
                        currentMediaType.value = 'image';
                    }
                    showStarModal.value = true;
                };

                const closeStarModal = () => {
                    showStarModal.value = false;
                    starModalCandidate.value = null;
                    currentMedia.value = '';
                    currentMediaType.value = 'image';
                };

                const setCurrentMedia = (src, type) => {
                    currentMedia.value = src;
                    currentMediaType.value = type;
                    // ê°¤ëŸ¬ë¦¬ ì„ íƒ ì‹œ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    // ë™ì˜ìƒ ì „í™˜ ì‹œ ìŒì†Œê±° ìƒíƒœ ì´ˆê¸°í™”
                    if (type === 'video') {
                        isMuted.value = true;
                    }
                };

                const starVideo = ref(null);

                const toggleMute = () => {
                    const video = document.querySelector('video[ref="starVideo"]') || document.querySelector('.aspect-square video');
                    if (video) {
                        video.muted = !video.muted;
                        isMuted.value = video.muted;
                    }
                };

                const selectStarAndClose = (candidate) => {
                    toggleCandidate(candidate);
                    closeStarModal();
                };

                const getCommentsForCandidate = (candidateId) => {
                    if (!candidateId) return [];
                    return comments.value.filter(c => c.candidateId === candidateId);
                };

                const addComment = (candidate) => {
                    if (!newComment.value.trim() || !candidate) return;
                    // ëŒ“ê¸€ ì‘ì„±ì— 10 í¬ë¼ìš´ í•„ìš”
                    if (userCrowns.value < 10) {
                        showRechargeModal.value = true;
                        return;
                    }
                    userCrowns.value -= 10;
                    comments.value.unshift({
                        id: Date.now(),
                        candidateId: candidate.id,
                        user: userName.value,
                        text: newComment.value.trim(),
                        time: 'ë°©ê¸ˆ ì „'
                    });
                    newComment.value = '';
                    // ëŒ“ê¸€ ì‘ì„± íš¨ê³¼
                    confetti({
                        particleCount: 30,
                        spread: 50,
                        origin: { y: 0.8 },
                        colors: ['#ec4899', '#8b5cf6']
                    });
                };

                const goToConfirm = () => {
                    currentView.value = 'confirm';
                };

                const submitVote = async () => {
                    submitting.value = true;
                    showBiometric.value = true;

                    await new Promise(r => setTimeout(r, 1500));
                    showBiometric.value = false;

                    await new Promise(r => setTimeout(r, 1000));

                    receiptCode.value = 'TX' + Math.random().toString(36).substring(2, 10).toUpperCase();
                    blockNumber.value = Math.floor(Math.random() * 10000) + 50000;
                    voteTime.value = new Date().toLocaleString('ko-KR');

                    submitting.value = false;
                    currentView.value = 'success';

                    // Confetti!
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#8b5cf6', '#6366f1', '#3b82f6', '#10b981']
                    });

                    const election = elections.value.find(e => e.id === selectedElection.value.id);
                    if (election) {
                        election.status = 'completed';
                        // ì „ì²´ ì„ ê±° ë°ì´í„° ì €ì¥ (ê²°ê³¼ ë³´ê¸° ë° í¬ë¼ìš´ ì „ì†¡ìš©)
                        completedElections.value.unshift({ ...election });
                        elections.value = elections.value.filter(e => e.id !== election.id);
                    }
                };

                const goBack = () => {
                    if (currentView.value === 'vote') {
                        currentView.value = 'home';
                        selectedElection.value = null;
                        selectedCandidates.value = [];
                    } else if (currentView.value === 'confirm') {
                        currentView.value = 'vote';
                    }
                    window.scrollTo(0, 0);
                };

                const goHome = () => {
                    currentView.value = 'home';
                    selectedElection.value = null;
                    selectedCandidates.value = [];
                    window.scrollTo(0, 0);
                };

                const getVotingModeLabel = (mode) => {
                    const labels = { single: '1ì¸ 1íˆ¬í‘œ', multi_limited: 'ë³µìˆ˜ íˆ¬í‘œ', periodic_reset: 'ì£¼ê¸°ì  ë¦¬ì…‹' };
                    return labels[mode] || mode;
                };

                const getRemainingTime = (endTime) => {
                    if (!endTime) return '';
                    const diff = new Date(endTime) - new Date();
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    if (days > 0) return `${days}ì¼ ${hours}ì‹œê°„`;
                    if (hours > 0) return `${hours}ì‹œê°„`;
                    return 'ê³§ ë§ˆê°';
                };

                const formatNumber = (num) => {
                    if (!num) return '0';
                    if (num >= 10000) return (num / 10000).toFixed(1) + 'ë§Œ';
                    if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                    return num.toLocaleString();
                };

                const getTotalCrowns = () => {
                    const starElection = elections.value.find(e => e.is_star_vote);
                    if (!starElection) return 0;
                    return starElection.candidates.reduce((sum, c) => sum + (c.crowns || 0), 0);
                };

                const getTotalVotes = () => {
                    const starElection = elections.value.find(e => e.is_star_vote);
                    if (!starElection) return 0;
                    return starElection.candidates.reduce((sum, c) => sum + (c.votes || 0), 0);
                };

                const getCrownPercent = (candidate) => {
                    if (!candidate) return 0;
                    const total = getTotalCrowns();
                    if (total === 0) return 0;
                    return ((candidate.crowns || 0) / total * 100).toFixed(1);
                };

                const getVotePercent = (candidate) => {
                    if (!candidate) return 0;
                    const total = getTotalVotes();
                    if (total === 0) return 0;
                    return ((candidate.votes || 0) / total * 100).toFixed(1);
                };

                const sendCrown = (candidate, amount) => {
                    if (!candidate) return;
                    // í¬ë¼ìš´ ë¶€ì¡±í•˜ë©´ ì¶©ì „ í™”ë©´ìœ¼ë¡œ
                    if (userCrowns.value < amount) {
                        showRechargeModal.value = true;
                        return;
                    }
                    userCrowns.value -= amount;

                    // ì›ë³¸ ë°ì´í„°ì—ì„œ í›„ë³´ì ì°¾ì•„ì„œ ì—…ë°ì´íŠ¸
                    const starElection = elections.value.find(e => e.is_star_vote);
                    if (starElection) {
                        const originalCandidate = starElection.candidates.find(c => c.id === candidate.id);
                        if (originalCandidate) {
                            originalCandidate.crowns = (originalCandidate.crowns || 0) + amount;
                            // ëª¨ë‹¬ ë°ì´í„°ë„ ì—…ë°ì´íŠ¸
                            if (starModalCandidate.value && starModalCandidate.value.id === candidate.id) {
                                starModalCandidate.value.crowns = originalCandidate.crowns;
                            }
                        }
                    }

                    // WebSocketìœ¼ë¡œ ì „ì†¡ (ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´)
                    if (wsConnection.value && wsConnection.value.readyState === WebSocket.OPEN) {
                        wsConnection.value.send(JSON.stringify({
                            type: 'crown',
                            candidateId: candidate.id,
                            amount: amount,
                            userId: userId.value
                        }));
                    }

                    // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                    confetti({
                        particleCount: Math.min(amount * 2, 100),
                        spread: 60,
                        origin: { y: 0.7 },
                        colors: ['#ffd700', '#ffaa00', '#ff8c00']
                    });
                };

                // í¬ë¼ìš´ êµ¬ë§¤ (ë°ëª¨ìš© - ì‹¤ì œë¡œëŠ” ê²°ì œ ì—°ë™ í•„ìš”)
                const purchaseCrowns = (crowns, price) => {
                    // ì‹¤ì œ ì•±ì—ì„œëŠ” ì—¬ê¸°ì„œ ê²°ì œ API í˜¸ì¶œ
                    // ë°ëª¨ì—ì„œëŠ” ë°”ë¡œ í¬ë¼ìš´ ì¶”ê°€
                    userCrowns.value += crowns;
                    showRechargeModal.value = false;

                    // êµ¬ë§¤ ì¶•í•˜ íš¨ê³¼
                    confetti({
                        particleCount: 150,
                        spread: 100,
                        origin: { y: 0.5 },
                        colors: ['#ffd700', '#ffaa00', '#ff8c00', '#8b5cf6', '#ec4899']
                    });
                };

                // Particle background
                const initParticles = () => {
                    const canvas = document.getElementById('particles');
                    const ctx = canvas.getContext('2d');
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;

                    const particles = [];
                    const particleCount = 30;

                    for (let i = 0; i < particleCount; i++) {
                        particles.push({
                            x: Math.random() * canvas.width,
                            y: Math.random() * canvas.height,
                            radius: Math.random() * 2 + 1,
                            vx: (Math.random() - 0.5) * 0.3,
                            vy: (Math.random() - 0.5) * 0.3,
                            color: ['#8b5cf6', '#6366f1', '#3b82f6'][Math.floor(Math.random() * 3)]
                        });
                    }

                    const animate = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);

                        particles.forEach(p => {
                            p.x += p.vx;
                            p.y += p.vy;

                            if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                            if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                            ctx.beginPath();
                            ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                            ctx.fillStyle = p.color + '30';
                            ctx.fill();
                        });

                        requestAnimationFrame(animate);
                    };

                    animate();

                    window.addEventListener('resize', () => {
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                    });
                };

                // WebSocket ì—°ê²° ë° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
                const wsConnection = ref(null);
                const isConnected = ref(false);

                const connectWebSocket = () => {
                    const wsUrl = 'ws://localhost:8000/ws/crowns';
                    try {
                        wsConnection.value = new WebSocket(wsUrl);

                        wsConnection.value.onopen = () => {
                            console.log('WebSocket ì—°ê²°ë¨');
                            isConnected.value = true;
                        };

                        wsConnection.value.onmessage = (event) => {
                            const data = JSON.parse(event.data);
                            handleRealtimeUpdate(data);
                        };

                        wsConnection.value.onclose = () => {
                            console.log('WebSocket ì—°ê²° ëŠê¹€, ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ ì „í™˜');
                            isConnected.value = false;
                            // ì—°ê²° ì‹¤íŒ¨ì‹œ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ
                            startSimulation();
                        };

                        wsConnection.value.onerror = () => {
                            console.log('WebSocket ì˜¤ë¥˜, ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ ì „í™˜');
                            isConnected.value = false;
                            startSimulation();
                        };
                    } catch (e) {
                        console.log('WebSocket ì—°ê²° ì‹¤íŒ¨, ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œë¡œ ì „í™˜');
                        startSimulation();
                    }
                };

                // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì²˜ë¦¬
                const handleRealtimeUpdate = (data) => {
                    const starElection = elections.value.find(e => e.is_star_vote);
                    if (!starElection) return;

                    if (data.type === 'crown') {
                        const candidate = starElection.candidates.find(c => c.id === data.candidateId);
                        if (candidate) {
                            candidate.crowns = (candidate.crowns || 0) + data.amount;
                            // ëª¨ë‹¬ ì—´ë ¤ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
                            if (starModalCandidate.value && starModalCandidate.value.id === data.candidateId) {
                                starModalCandidate.value.crowns = candidate.crowns;
                            }
                        }
                    } else if (data.type === 'vote') {
                        const candidate = starElection.candidates.find(c => c.id === data.candidateId);
                        if (candidate) {
                            candidate.votes = (candidate.votes || 0) + 1;
                            if (starModalCandidate.value && starModalCandidate.value.id === data.candidateId) {
                                starModalCandidate.value.votes = candidate.votes;
                            }
                        }
                    }
                };

                // ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ (ë°±ì—”ë“œ ì—†ì„ ë•Œ ë°ëª¨ìš©)
                const simulationInterval = ref(null);
                const startSimulation = () => {
                    if (simulationInterval.value) return;

                    simulationInterval.value = setInterval(() => {
                        const starElection = elections.value.find(e => e.is_star_vote);
                        if (!starElection) return;

                        // ëœë¤ í›„ë³´ì—ê²Œ í¬ë¼ìš´ ì¶”ê°€
                        const randomIndex = Math.floor(Math.random() * starElection.candidates.length);
                        const candidate = starElection.candidates[randomIndex];
                        const amount = [1, 1, 1, 5, 10, 10, 50, 100][Math.floor(Math.random() * 8)];

                        candidate.crowns = (candidate.crowns || 0) + amount;

                        // ëª¨ë‹¬ ì—´ë ¤ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
                        if (starModalCandidate.value && starModalCandidate.value.id === candidate.id) {
                            starModalCandidate.value.crowns = candidate.crowns;
                        }

                        // ê°€ë” íˆ¬í‘œë„ ì¶”ê°€ (20% í™•ë¥ )
                        if (Math.random() < 0.2) {
                            const voteIndex = Math.floor(Math.random() * starElection.candidates.length);
                            const voteCandidate = starElection.candidates[voteIndex];
                            voteCandidate.votes = (voteCandidate.votes || 0) + 1;
                            if (starModalCandidate.value && starModalCandidate.value.id === voteCandidate.id) {
                                starModalCandidate.value.votes = voteCandidate.votes;
                            }
                        }
                    }, 2000 + Math.random() * 3000); // 2~5ì´ˆ ê°„ê²©
                };

                onMounted(() => {
                    initParticles();
                    // WebSocket ì—°ê²° ì‹œë„ (ì‹¤íŒ¨í•˜ë©´ ìë™ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜)
                    connectWebSocket();
                });

                return {
                    currentView,
                    userName,
                    userId,
                    userCrowns,
                    submitting,
                    showBiometric,
                    elections,
                    activeElections,
                    completedElections,
                    selectedElection,
                    selectedCandidates,
                    showStarModal,
                    starModalCandidate,
                    currentMedia,
                    currentMediaType,
                    newComment,
                    comments,
                    receiptCode,
                    blockNumber,
                    voteTime,
                    headerTitle,
                    selectElection,
                    viewCompletedElection,
                    toggleCandidate,
                    isSelected,
                    openStarModal,
                    closeStarModal,
                    setCurrentMedia,
                    selectStarAndClose,
                    getCommentsForCandidate,
                    addComment,
                    goToConfirm,
                    submitVote,
                    goBack,
                    goHome,
                    getVotingModeLabel,
                    getRemainingTime,
                    formatNumber,
                    getCrownPercent,
                    getVotePercent,
                    sendCrown,
                    isConnected,
                    showRechargeModal,
                    purchaseCrowns,
                    isMuted,
                    starVideo,
                    toggleMute
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
